<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd 
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd">
	<sub-flow name="inserting-Customer-flow" doc:id="c9d066b5-04a2-4cfe-ae0c-0058ca40d601" >
		<logger level="INFO" doc:name="process layer start logger" doc:id="81af1c17-94e6-4378-af8f-e1df1a844f2a" message="#[payload]" />
		<ee:transform doc:name="storing inputData" doc:id="14862d22-eae6-4b4c-9d6b-d0bced00d12c" >
			<ee:message >
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="inputData" ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<http:request method="GET" doc:name="Requesting system customer data flow" doc:id="a3248f59-8500-467d-a597-7ec5ecc9eb47" config-ref="HTTP_Request_configuration" path="${http.request.customerPath}" responseTimeout="8000000" />
		<ee:transform doc:name="payload of customer" doc:id="81e58fc3-2b6a-4be9-b1b6-90c34281094a">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
			<ee:variables>
				<ee:set-variable variableName="data"><![CDATA[%dw 2.0
output application/json
---
vars.inputData.phoneNum as String]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<choice doc:name="Choice" doc:id="b2415e75-f3ec-44c1-ab7c-f51a3365f7b2" >
			<when expression='#[sizeOf(payload.phoneNum filter ((item, index) -&gt; item==vars.data))&gt;0]'>
				<ee:transform doc:name="customer Existed" doc:id="50b6aada-d443-4e7b-b68f-3b852e0b0c45">
					<ee:message>
						<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
 "customerId already existed" ]]></ee:set-payload>
					</ee:message>
				</ee:transform>
			</when>
			<otherwise>
				<http:request method="POST" doc:name="Requesting system customer insert flow" doc:id="70636210-6794-4801-864b-beaf6823d57f" path="${http.request.customerPath}" responseTimeout="8000000" config-ref="HTTP_Request_configuration">
			<http:body><![CDATA[#[vars.inputData]]]></http:body>
		</http:request>
				<ee:transform doc:name="payload of customer" doc:id="aa214e51-bb52-4090-b487-fb601ced0cdf">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="final payload" doc:id="aada4d5f-4163-467d-b03d-4ce44ab0082c" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="end Logger" doc:id="44015674-8295-4736-9d35-210af6bd4840" message="#[payload]"/>
	
</sub-flow>
	<sub-flow name="fetching-customerDetails-flow" doc:id="d539b59f-9b54-430b-afe3-f1a6910d888d" >
		<logger level="INFO" doc:name="start Logger" doc:id="d32217e0-a9d4-4a4a-b339-f720d118d220" message='#["start logger"]'/>
		<http:request method="GET" doc:name="Requesting system customer data flow" doc:id="bee2f32e-4adf-45ad-b6ff-22a4f3f439ca" path="${http.request.customerPath}" responseTimeout="8000000" config-ref="HTTP_Request_configuration">
		</http:request>
		<ee:transform doc:name="customer payload" doc:id="e97ddf96-8c1c-4a04-9684-54b924dcb42f" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="end Logger" doc:id="d7a585f1-a2a2-41da-80f7-38e0ca8dfa37" message='#["end logger"]'/>
	</sub-flow>
	<sub-flow name="updating-Customer_Flow" doc:id="1e0a684d-4f74-49f5-86d1-58cdfcf02b98" >
		<logger level="INFO" doc:name="start Logger" doc:id="67987736-e281-44cd-8333-0038d8b5f31e" message='#["update start logger"]'/>
		<ee:transform doc:name="metaData" doc:id="f2a2d07e-da9d-444b-87df-9b3f99ba35f6" >
			<ee:message >
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="inputData" ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-variable>
				<ee:set-variable variableName="id" ><![CDATA[%dw 2.0
output application/json
---
attributes.queryParams.customerId]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<http:request method="PUT" doc:name="Requesting system customer data flow" doc:id="5c56b4cb-6598-451f-aeeb-e730f7d961a0" path="${http.request.customerPath}" responseTimeout="800000000" config-ref="HTTP_Request_configuration">
			<http:body ><![CDATA[#[vars.inputData]]]></http:body>
			<http:query-params ><![CDATA[#[output application/json
---
{
	"customerId" : vars.id
}]]]></http:query-params>
		</http:request>
		<ee:transform doc:name="customer payload" doc:id="3e2d3e29-e8c5-4529-aad7-0370f51fdd1f" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="end Logger" doc:id="4d1b035d-e2af-41a0-9475-bdf61aced121" message='#["update end logger"]'/>
	</sub-flow>
	<sub-flow name="deleteCustomer_Flow" doc:id="0d9ae2a1-8786-4600-b947-68786e347794" >
		<logger level="INFO" doc:name="start Logger" doc:id="b363ed91-dfea-493a-8403-96e730356c60" message='#["delete start logger"]'/>
		<ee:transform doc:name="metaData" doc:id="f5b67947-84b3-40bf-b711-b2791cbc2bad" >
			<ee:message >
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="id" ><![CDATA[%dw 2.0
output application/json
---
attributes.queryParams.customerId]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<http:request method="GET" doc:name="Requesting system customer flow" doc:id="6a6e9b0a-118d-4554-b09a-ed7d3a2b1666" path="${http.request.customerPath}" responseTimeout="8000000" config-ref="HTTP_Request_configuration">
			<http:query-params ><![CDATA[#[output application/json
---
{
	"customerId" : vars.id
}]]]></http:query-params>
		</http:request>
		<ee:transform doc:name="customer payload" doc:id="ea9b1f69-6476-4a86-8a85-27cd0c8a355e" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="end Logger" doc:id="752f101e-9768-41d7-865a-1d1c129ddb16" />
	</sub-flow>
	<sub-flow name="inserting-ProductData-flow" doc:id="600dfa74-695c-47fa-8f33-bd39c8a81279" >
		<logger level="INFO" doc:name="start Logger" doc:id="b89cb148-464f-43b1-b6c6-6033dad624e4" message='#["insert start logger"]'/>
		<ee:transform doc:name="inputData" doc:id="f195bca2-0414-4b85-a166-330155d89a6d" >
			<ee:message >
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="inputData" ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<http:request method="GET" doc:name="Requesting system product data flow" doc:id="bca8494c-332a-4d29-839e-1dbe16556acd" config-ref="HTTP_Request_configuration" path="${http.request.productPath}" responseTimeout="8000000" />
		<ee:transform doc:name="product payload" doc:id="34cd223f-732c-4f7d-9bbc-13c3311a0fee" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="Sno" ><![CDATA[%dw 2.0
output application/json
---
vars.inputData.serialNo]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<choice doc:name="Choice" doc:id="99bfa473-6004-40e5-8c39-905fddefa4c1" >
			<when expression="#[sizeOf(payload.serialNo filter ((item, index) -&gt; item== vars.Sno))&gt;0]">
				<ee:transform doc:name="product existed message" doc:id="19fcaf38-29fc-4842-8116-3c032a12defb" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
"product serialNo already existed"]]></ee:set-payload>
					</ee:message>
				</ee:transform>
			</when>
			<otherwise >
				<http:request method="POST" doc:name="Requesting system product data flow" doc:id="a8275c61-fc8d-4dc3-8c9f-404ccfe8019c" path="${http.request.productPath}" responseTimeout="8000000" config-ref="HTTP_Request_configuration">
			<http:body><![CDATA[#[vars.inputData]]]></http:body>
		</http:request>
				<ee:transform doc:name="product payload" doc:id="3ce51761-5a48-48c4-820c-e44a5b5a6478" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
					</ee:message>
				</ee:transform>
			</otherwise>
		</choice>
		<logger level="INFO" doc:name="end Logger " doc:id="6d6df255-934b-4696-9266-b77971c2776f" message='#["insert end logger"]'/>
	</sub-flow>
	<sub-flow name="fetching-ProductData-flow" doc:id="0d9636fe-8155-447a-8cd9-a716b7015312" >
		<logger level="INFO" doc:name="start Logger" doc:id="6154240f-8532-47ee-ab15-b92456066c70" message='#["fetching start logger"]'/>
		<http:request method="GET" doc:name="Requesting system product data flow" doc:id="f3114d1d-536b-4a34-968c-c28371d5f7eb" path="${http.request.productPath}" responseTimeout="8000000" config-ref="HTTP_Request_configuration"/>
		<ee:transform doc:name="product payload" doc:id="36e02e64-3bc3-49a1-8a17-4b1a10b42287">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="end Logger" doc:id="f883e7b9-1f4d-42b6-ac64-93a4be9500c2" message='#["fetching end logger"]'/>
	</sub-flow>
	<sub-flow name="updating-Product-flow" doc:id="b1a06795-b742-4c4e-827f-8cc455a9ab19" >
		<logger level="INFO" doc:name="start Logger" doc:id="45e425cb-c4e2-4e97-8657-21be89e77949" message='#["update start logger"]'/>
		<ee:transform doc:name="metaData" doc:id="b40a0221-0061-40f7-a3da-247ad0898a34" >
			<ee:message >
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="inputData" ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-variable>
				<ee:set-variable variableName="id" ><![CDATA[%dw 2.0
output application/json
---
attributes.queryParams.productId]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<http:request method="PUT" doc:name="Requesting system product data flow" doc:id="066a6ad7-a3d2-4ee4-85cf-1dcd86f7dbc5" path="${http.request.productPath}" responseTimeout="8000000" config-ref="HTTP_Request_configuration">
			<http:body ><![CDATA[#[vars.inputData]]]></http:body>
			<http:query-params ><![CDATA[#[output application/java
---
{
	"productId" : vars.id
}]]]></http:query-params>
		</http:request>
		<logger level="INFO" doc:name="end Logger" doc:id="88bff806-b463-4f5d-be28-aa42b20a0b54" message='#["update end logger"]'/>
	</sub-flow>
	<sub-flow name="delete-Product-flow" doc:id="61d15b0b-a0e9-4468-bada-6cb6e7460356" >
		<logger level="INFO" doc:name="start Logger" doc:id="4d809629-385d-48d8-901c-64d1adc53502" message='#["delete start logger"]'/>
		<ee:transform doc:name="metaData" doc:id="03029d0b-3902-4b70-89aa-cee5716ce40e" >
			<ee:message >
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="id" ><![CDATA[%dw 2.0
output application/json
---
attributes.queryParams.productId]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<http:request method="DELETE" doc:name="Requesting system product flow" doc:id="75169a19-810e-47e3-b7b0-22e618b5eeea" path="${http.request.productPath}" responseTimeout="8000000" config-ref="HTTP_Request_configuration">
			<http:query-params ><![CDATA[#[output application/java
---
{
	"productId" : vars.id
}]]]></http:query-params>
		</http:request>
		<logger level="INFO" doc:name="end Logger" doc:id="70aa3889-e320-41fb-b1fb-1f836a9a5709" message='#["delete end logger"]'/>
	</sub-flow>
	<sub-flow name="fetchTransactionDetails_Flow" doc:id="98d08620-afb7-485d-914f-a7dfdae1c93d" >
		<logger level="INFO" doc:name="start Logger" doc:id="e0bb28bb-df60-48a7-96e9-d13f75b67600" message='#["start transaction flow "]'/>
		<http:request method="GET" doc:name="Requesting system transaction flow" doc:id="f2486992-d661-4ccd-8442-3d41a1893b57" path="${http.request.transactionPath}" responseTimeout="8000000" config-ref="HTTP_Request_configuration">
			<http:query-params ><![CDATA[#[output application/java
---
{
	"transactionDate" : attributes.queryParams.transactionDate
	
}]]]></http:query-params>
		</http:request>
		<ee:transform doc:name="transaction payload" doc:id="984b5875-27f7-4eeb-aa1e-f92230cd7561">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="end Logger" doc:id="c576c57f-1640-4a79-808e-ee1a21220732" message='#["end logger"]'/>
	</sub-flow>
	<sub-flow name="transactionReport-flow" doc:id="8d62ed30-1261-46ab-bbf0-f697d2e77c68" >
		<logger level="INFO" doc:name="start Logger" doc:id="a6fab930-c1d3-4fed-9e4a-676aac28936c" message='#["start logger"]'/>
		<ee:transform doc:name="metaData" doc:id="1dfa858a-d8a0-4e79-843e-b4e25c558a02">
			<ee:message />
			<ee:variables>
				<ee:set-variable variableName="startDate"><![CDATA[%dw 2.0
output application/json
---
((attributes.queryParams.transactionDate splitBy  "to") [0])]]></ee:set-variable>
				<ee:set-variable variableName="endDate"><![CDATA[%dw 2.0
output application/json
---
((attributes.queryParams.transactionDate splitBy  "to") [-1])]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<http:request method="GET" doc:name="Requesting system transactionReport flow" doc:id="9212b5c4-5876-44fc-a26f-e6f7123ad252" path="${http.request.transactionReportPath}" responseTimeout="8000000" config-ref="HTTP_Request_configuration">
			<http:query-params ><![CDATA[#[output application/java
---
{
	"transactionDate" : attributes.queryParams.transactionDate
	
}]]]></http:query-params>
		</http:request>
		<ee:transform doc:name="transactionReport payload" doc:id="6c83372c-5261-4e98-be8e-abcb4469fa07">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
			<ee:variables>
			</ee:variables>
		</ee:transform>
		<logger level="INFO" doc:name="end Logger" doc:id="582e5ea3-017d-4e3d-a9c3-07db08cdcc34" message='#["end logger"]'/>
	</sub-flow>
	
</mule>
